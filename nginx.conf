# Nginx 配置 - Vanilla DOM Playground

server {
    listen 80;
    server_name localhost;

    # 根目錄
    root /usr/share/nginx/html;
    index learn.html index.html;

    # 日誌配置
    access_log /var/log/nginx/access.log;
    error_log /var/log/nginx/error.log;

    # Gzip 壓縮
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css text/xml text/javascript
               application/x-javascript application/xml+rss
               application/javascript application/json;

    # 設定正確的 MIME 類型
    types {
        text/html                             html htm shtml;
        text/css                              css;
        text/xml                              xml;
        application/javascript                js;
        application/json                      json;
        image/jpeg                            jpeg jpg;
        image/png                             png;
        image/gif                             gif;
        image/svg+xml                         svg svgz;
        image/x-icon                          ico;
        font/woff                             woff;
        font/woff2                            woff2;
    }

    # 主路由 - 預設導向學習中心
    location = / {
        return 301 /learn.html;
    }

    # 所有 HTML 頁面
    location ~ \.html$ {
        add_header Cache-Control "no-cache, must-revalidate";
        add_header X-Content-Type-Options "nosniff";
        try_files $uri =404;
    }

    # JavaScript 模組 - 確保正確的 MIME 類型
    location ~ \.js$ {
        add_header Content-Type "application/javascript; charset=utf-8";
        add_header Cache-Control "public, max-age=86400";
        add_header X-Content-Type-Options "nosniff";
        try_files $uri =404;
    }

    # CSS 文件
    location ~ \.css$ {
        add_header Content-Type "text/css; charset=utf-8";
        add_header Cache-Control "public, max-age=86400";
        try_files $uri =404;
    }

    # 圖片和靜態資源
    location ~* \.(jpg|jpeg|png|gif|ico|svg|woff|woff2|ttf|eot)$ {
        add_header Cache-Control "public, max-age=2592000";
        try_files $uri =404;
    }

    # JSON 文件
    location ~ \.json$ {
        add_header Content-Type "application/json; charset=utf-8";
        add_header Cache-Control "no-cache";
        try_files $uri =404;
    }

    # Markdown 文件（文檔）
    location ~ \.md$ {
        add_header Content-Type "text/markdown; charset=utf-8";
        add_header Cache-Control "no-cache";
        try_files $uri =404;
    }

    # 學習中心
    location /learn.html {
        add_header Cache-Control "no-cache";
        try_files $uri =404;
    }

    # 構建模式
    location /index.html {
        add_header Cache-Control "no-cache";
        try_files $uri =404;
    }

    # 成就中心
    location /achievement-test.html {
        add_header Cache-Control "no-cache";
        try_files $uri =404;
    }

    # 測試頁面
    location ~* -test\.html$ {
        add_header Cache-Control "no-cache";
        try_files $uri =404;
    }

    # 文檔目錄
    location /docs/ {
        autoindex on;
        add_header Cache-Control "no-cache";
    }

    # 健康檢查端點
    location /health {
        access_log off;
        return 200 "healthy\n";
        add_header Content-Type text/plain;
    }

    # 404 錯誤處理
    error_page 404 /404.html;
    location = /404.html {
        internal;
    }

    # 50x 錯誤處理
    error_page 500 502 503 504 /50x.html;
    location = /50x.html {
        internal;
    }
}
